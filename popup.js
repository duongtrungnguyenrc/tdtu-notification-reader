/**
 * @copyright (c) 2025 ÄÆ°á»ng Trung NguyÃªn
 * @license MIT
 * @author ÄÆ°á»ng Trung NguyÃªn
 * @link https://github.com/duongtrungnguyenrc
 */

document.addEventListener("DOMContentLoaded",(async()=>{const t=t=>document.getElementById(t),e=t("username"),a=t("password"),n=t("login"),o=t("reload"),i=t("notifications"),r=t("important-notifications"),s=document.body,c=await chrome.storage.local.get(["username","password","notifications","importantNotifications"]);function l(){chrome.runtime.sendMessage({action:"fetchData"},(t=>{chrome.runtime.lastError?console.error("Lá»—i:",chrome.runtime.lastError.message):console.log("Dá»¯ liá»‡u cáº­p nháº­t!")}))}function d(t,e,a=!1){t.innerHTML=e.length?e.map((({tieuDe:t,tomTatNoiDung:e,link:n})=>`\n          <div class="notification ${a?"important":""}" data-link="${n}">\n            <strong>${t}</strong>\n            <p>${e}</p>\n          </div>\n        `)).join(""):"KhÃ´ng cÃ³ thÃ´ng bÃ¡o.",t.querySelectorAll(".notification").forEach((t=>{t.addEventListener("click",(()=>{const e=t.dataset.link;chrome.runtime.sendMessage({action:"openNotification",url:e},(t=>{chrome.runtime.lastError?console.error("Lá»—i:",chrome.runtime.lastError.message):console.log("ðŸ”— ÄÃ£ má»Ÿ link:",e)}))}))}))}c.username&&c.password&&(e.value=c.username,a.value=c.password,s.classList.add("ready")),d(i,c.notifications||[]),d(r,c.importantNotifications||[],!0),n.addEventListener("click",(async()=>{const t=e.value.trim(),n=a.value.trim();if(!t||!n)return alert("Nháº­p MSSV vÃ  máº­t kháº©u!");await chrome.storage.local.set({username:t,password:n}),s.classList.add("ready"),l()})),o.addEventListener("click",l),document.querySelectorAll(".tab-button").forEach((e=>{e.addEventListener("click",(({target:e})=>{document.querySelectorAll(".tab-button.active, .tab-panel.active").forEach((t=>t.classList.remove("active"))),t(e.dataset.tab).classList.add("active"),e.classList.add("active")}))})),chrome.storage.onChanged.addListener(((t,e)=>{"local"===e&&(t.notifications&&d(i,t.notifications.newValue||[]),t.importantNotifications&&d(r,t.importantNotifications.newValue||[],!0))}))}));